# Progress Log

## Codebase Patterns

### Project Structure
- Components in `src/components/`, tiles in `src/components/tiles/`
- Detail renderers in `src/components/detail/` — KPIDetail, ConsultationDetail, SkillDetail, SkillsAllDetail, EducationDetail, ProjectDetail
- Data files in `src/data/` — consultations.ts, medications.ts, problems.ts, investigations.ts, documents.ts, patient.ts, tags.ts, alerts.ts, kpis.ts, skills.ts, educationExtras.ts, constellation.ts
- Types in `src/types/pmr.ts` (PMR interfaces) and `src/types/index.ts` (Phase type)
- Hooks in `src/hooks/` — useActiveSection.ts, useFocusTrap.ts
- Contexts in `src/contexts/` — AccessibilityContext.tsx (has 1 pre-existing ESLint warning — expected), DetailPanelContext.tsx (has 1 pre-existing ESLint warning — expected)
- Lib in `src/lib/` — search.ts (fuse.js integration)
- Path alias: `@/` maps to `./src/`

### Phase Management
- App.tsx controls phase: 'boot' -> 'ecg' -> 'login' -> 'pmr'
- Phase type defined in `src/types/index.ts` as `'boot' | 'ecg' | 'login' | 'pmr'`
- BootSequence.tsx handles terminal animation — LOCKED
- ECGAnimation.tsx handles heartbeat + letter tracing + flatline exit — LOCKED
- LoginScreen.tsx bridges to dashboard (was PMRInterface, now DashboardLayout)

### Data Architecture (CORRECT — do not modify existing files)
- All data files are populated with accurate CV content from References/CV_v4.md
- 5 consultation entries (roles), 18 medications (skills with prescribingHistory), 11 problems (achievements), 6 investigations (projects), 5 documents (education)
- Types are properly defined in pmr.ts — Consultation, Medication, Problem, Investigation, Document, Patient, ViewId
- New types needed: Tag, Alert, KPI, SkillMedication (Task 2)

### Lucide Icons Typing
- Use `LucideIcon` type from `lucide-react` for icon maps, NOT `React.ComponentType<{ size: number }>` — the latter causes TS errors with ForwardRefExoticComponent

### Known Dependencies
- React 18.3.1, TypeScript, Vite
- Tailwind CSS for utility classes
- Framer Motion 11.15.0 for animations
- Lucide React 0.468.0 for icons
- fuse.js 7.0.0 (already installed) for fuzzy search

### Typography
- Elvaro Grotesque (`font-ui`) — primary UI font, 7 weights (300-900), loaded from Fonts/ directory
- Blumir (`font-ui-alt`) — alternative, variable font (100-700)
- Geist Mono (`font-geist`) — timestamps, data values, coded entries
- Fira Code (`font-mono`) — boot/ECG terminal only
- Do NOT use Inter, Roboto, DM Sans, or system defaults
- DM Sans in the concept HTML is a PLACEHOLDER — use Elvaro Grotesque
- Font mapping was corrected in Task 1: Elvaro = font-ui (primary), Blumir = font-ui-alt (alternative)

### Design Tokens
- Dashboard background: use `--bg-dashboard` (#F0F5F4), NOT `--bg` (#FFFFFF which is for boot/ECG)
- Three-tier shadows: `--shadow-sm` (resting), `--shadow-md` (hover/interactive), `--shadow-lg` (overlays)
- Border tiers: `--border` (#D4E0DE, structural), `--border-light` (#E4EDEB, cards)
- Accent: `--accent` (#0D6E6E teal), `--accent-hover` (#0A8080), `--accent-light` (rgba 0.08), `--accent-border` (rgba 0.18)
- Status colors each have base + light + border variants (success, amber, alert, purple)
- Tailwind: `pmr-*` prefix for all dashboard colors (e.g., `bg-pmr-bg`, `text-pmr-accent`, `border-pmr-border-light`)
- Tailwind shadows: `shadow-pmr-sm`, `shadow-pmr-md`, `shadow-pmr-lg`
- Tailwind radius: `rounded-card` (8px), `rounded-card-sm` (6px), `rounded-login` (12px)

### Dashboard Layout
- DashboardLayout.tsx is the main container for the pmr phase — replaces PMRInterface
- Three-zone: TopBar (fixed, z-100, 48px) + Sidebar (fixed left, 272px) + Main (scrollable card grid)
- Card grid: CSS Grid `repeat(2, 1fr)` gap 16px, responsive 1fr at ≤900px via `.dashboard-grid` class
- Entrance: three separate Framer Motion variants (topbar → sidebar → content), staggered with delays
- Sidebar: default export (`import Sidebar from './Sidebar'`), TopBar: named export (`import { TopBar } from './TopBar'`)
- Background color transition: DashboardLayout covers App.tsx's `bg-black` with `var(--bg-dashboard)` + `minHeight: 100vh`

### Tile Expansion Pattern
- Framer Motion `AnimatePresence` + `motion.div` with `initial={{ height: 0 }}`, `animate={{ height: 'auto' }}`, `exit={{ height: 0 }}`
- `overflow: hidden` on the motion.div
- `prefers-reduced-motion` checked at module scope: `const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches`
- Transition: `prefersReducedMotion ? { duration: 0 } : { duration: 0.2, ease: 'easeOut' }`
- State: `expandedItemId: string | null` per tile component
- Keyboard: Enter/Space toggle, Escape collapse
- `role="button"`, `tabIndex={0}`, `aria-expanded` on clickable items
- Colored left border (2px) on expanded content panel
- CareerActivity maps activity→consultation via `consultationId`, CoreSkills maps skill→medication by name match

### Command Palette
- `CommandPalette.tsx` renders at DashboardLayout level (z-index 1000, fixed overlay)
- Triggered by Ctrl+K (global listener in DashboardLayout) or TopBar search bar click
- Data model: `PaletteItem` with `PaletteAction` union (scroll, expand, link, download)
- `buildPaletteData()` returns 24 items across 6 sections, `buildSearchIndex()` wraps fuse.js
- `groupBySection()` maintains section order: Experience → Core Skills → Active Projects → Achievements → Education → Quick Actions
- All tiles have `data-tile-id` attribute (via Card `tileId` prop) for scroll targeting
- CSS animations in index.css: `palette-overlay-in`, `palette-modal-in` with `prefers-reduced-motion` overrides
- Legacy search exports (`SearchResult`, `buildLegacySearchIndex`, `groupResultsBySection`) kept for ClinicalSidebar backward compat — remove in Task 21

### Visual Review
- Dev server runs on `http://localhost:5173` throughout the loop
- App has boot→ECG→login→dashboard sequence (~15s on first load)
- If browser tools fail, skip visual review and note in iteration log — don't block progress

## Manual Intervention — 2026-02-13
### Reason: Complete redesign — replacing CareerRecord PMR with GP System Dashboard
### Changes made:
- **IMPLEMENTATION_PLAN.md**: Completely rewritten with 21 new tasks for GP System dashboard overhaul
- **guardrails.md**: Completely rewritten for new design direction (teal palette, tile-based layout, 8px radius, new shadow system)
- **progress.txt**: This intervention entry added
- **CLAUDE.md**: Will be updated by Task 3 in the new plan (architecture, colors, components, styling)

### Previous plan status: 15/15 tasks completed (all checked off)
### New plan: 21 tasks across 4 phases (Foundation → Core Layout → Dashboard Tiles → Interactions → Polish)

### What's being replaced:
- `PatientBanner.tsx` → `TopBar.tsx` (white top bar with search and session info)
- `ClinicalSidebar.tsx` → `Sidebar.tsx` (light background #F7FAFA, person header, tags, alerts only)
- `PMRInterface.tsx` → `DashboardLayout.tsx` (topbar + sidebar + scrollable card grid)
- All 7 `views/*.tsx` files → Dashboard tile components in `src/components/tiles/`
- Color palette: dark sidebar (#1E293B) + NHS Blue (#005EB8) → light sidebar (#F7FAFA) + teal (#0D6E6E)
- Navigation: sidebar-nav view-switching → single scrollable dashboard with expandable tiles
- Patient banner scroll condensation → removed (no banner, just topbar)

### What's preserved:
- Boot sequence (BootSequence.tsx) — LOCKED
- ECG animation (ECGAnimation.tsx) — LOCKED
- Login screen (LoginScreen.tsx) — unchanged
- Font setup: Elvaro Grotesque (primary UI), Blumir (alt), Geist Mono (data), Fira Code (terminal only)
- All data files in src/data/ — content unchanged, new data files added
- fuse.js dependency — reused for command palette search
- App.tsx phase management (boot → ecg → login → pmr) — pmr phase now renders DashboardLayout

### Context for next iteration:
- The reference design is `References/GPSystemconcept.html` — READ THIS before starting any visual task
- The old PMR components STILL EXIST in the codebase. Don't delete them yet — some expand/collapse patterns and data rendering can be reused inside tile expansion (Task 16). Cleanup happens in Task 21.
- Login screen still transitions to `#1E293B` background. The new dashboard has `#F0F5F4` background. The LoginScreen.tsx may need a background color update, or the transition can be handled in DashboardLayout's entrance animation.
- The concept HTML uses DM Sans font — this is a PLACEHOLDER. Production uses Elvaro Grotesque (font-ui). Do not switch to DM Sans.
- The concept's command palette has a comprehensive data model — use it as reference for building the palette in Task 18.
- Tile interactions (expansion, KPI flip) are in Phase 3. Tiles in Phase 2 should be built as static/display-only first, with data attributes or props that Phase 3 can hook into.

### New guardrails added:
- Accent color: teal #0D6E6E (replacing NHS Blue #005EB8 as primary interactive color)
- Border radius: 8px for cards (was 4px)
- Shadow system: three-tier (sm/md/lg) replacing single pmr shadow
- Sidebar: light background, PersonHeader + Tags + Alerts ONLY (projects, skills, education moved to tiles)
- Layout: TopBar + Sidebar + Card Grid (replacing PatientBanner + ClinicalSidebar + view switching)
- Tile ordering: Patient Summary → Latest Results + Core Skills → Last Consultation → Career Activity → Education → Projects
- Skills frequency: user-specified values (Data Analysis=twice daily, etc.)

## Iteration Log

### Iteration 1 — Task 1: Update design tokens and Tailwind config
**Status:** Complete
**Changes:**
- Updated `src/index.css`: Added full GP System Dashboard token set (colors, shadows, layout vars, status colors with light/border variants). Kept legacy `--pmr-*` aliases for backward compat. Updated values of legacy tokens to match new palette (e.g., `--pmr-content` → `#F0F5F4`, `--pmr-sidebar` → `#F7FAFA`, `--pmr-radius` → `8px`).
- Updated `tailwind.config.js`: New pmr color tokens (bg, surface, sidebar, accent, text-primary/secondary/tertiary, border/border-light, success, amber, alert, purple). Three-tier shadow system (pmr-sm/md/lg). Border-radius updated (card=8px, card-sm=6px, login=12px).
- **Fixed font-ui/font-ui-alt swap**: Previous iterations had Blumir as `font-ui` and Elvaro as `font-ui-alt` — this was backwards. Now corrected: Elvaro Grotesque = `font-ui` (primary), Blumir = `font-ui-alt` (alternative). No components were using these classes directly, so no breakage.
- Used `--bg-dashboard` for the dashboard background (not `--bg`) to avoid conflicting with the existing `--bg: #FFFFFF` used by boot/ECG phases.
**Learnings:**
- The `--bg` CSS var is used for boot/ECG phases (#FFFFFF). Dashboard background uses `--bg-dashboard` (#F0F5F4) to avoid collision.
- No existing components reference `font-ui` or `font-ui-alt` Tailwind classes, so the font swap was safe.
- The old shadow tokens (`pmr-hover`, `pmr-banner`) were not referenced in any component code.
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable (token-only changes, no visual components yet)

### Iteration 2 — Task 2: Create new data files and update types
**Status:** Complete
**Changes:**
- Created `src/data/profile.ts` — personal statement extracted from CV_v4.md (exact match)
- Created `src/data/tags.ts` — 5 sidebar tags with color variants (teal, amber, green)
- Created `src/data/alerts.ts` — 2 sidebar alert flags (£14.6M savings, £220M budget) with severity and lucide-react icon names
- Created `src/data/kpis.ts` — 4 KPI metrics (Budget, Savings, Years, Team Size) with values, labels, subs, color variants, and explanation text for flip cards
- Created `src/data/skills.ts` — 5 technical skills as "SkillMedication" entries with user-specified frequencies (Data Analysis="Twice daily", Python="Daily", SQL="Daily", Power BI="Once weekly", JS/TS="When required"), plus years, proficiency, category, status, and lucide-react icon names
- Updated `src/types/pmr.ts` — added 4 new interfaces: Tag, Alert, KPI, SkillMedication
**Learnings:**
- All new data files follow the established pattern: import types, export const array
- Icon names are stored as strings (lucide-react icon names) — components will dynamically import them
- Skills frequency strings are user-specified values (not standardized enum like old Medication type)
- KPI explanations are substantial text blocks for flip card backs — these will be displayed in full when users flip the cards
- All CV numbers/dates verified against CV_v4.md — £220M, £14.6M, 9+ years, team of 12, start years for skills
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable (data-only changes, no visual components yet)

### Iteration 3 — Task 4: Build TopBar component
**Status:** Complete
**Changes:**
- Created `src/components/TopBar.tsx` — fixed 48px header with three zones:
  - Left: Home icon (lucide-react, 18px, accent) + "Headhunt Medical Center" (13px, 600 weight) + "Remote" version badge (11px, tertiary)
  - Center: Search bar button (max-width 560px, min-width 400px, 42px height) with Search icon, placeholder text, Ctrl+K kbd badge. On click triggers `onSearchClick` prop (for command palette in Task 18). Hidden on mobile (<768px). Hover/focus border transitions to accent color with focus ring.
  - Right: "Dr. A.CHARLWOOD" text (hidden on <640px) + "Active Session · [time]" pill badge (Geist Mono, accent-light bg, accent-border)
- Component uses CSS custom properties from Task 1 tokens (--surface, --border, --accent, --text-primary, --text-secondary, --text-tertiary, --bg-dashboard, --accent-light, --accent-border)
- Live time updates every 60 seconds using setInterval
- Search bar is a `<button>` element (not input) — it doesn't do inline search, only triggers the command palette
- Responsive: search bar hidden on <768px (md breakpoint), user name hidden on <640px (sm breakpoint)
**Learnings:**
- Search bar should be a button, not an input — it triggers the command palette overlay (Task 18). No inline filtering.
- Using `var(--radius-card)` for 8px border radius on the search bar container
- Time format: 24-hour (en-GB locale), no seconds — matches clinical system convention
- TopBar is not yet wired into DashboardLayout (that's Task 7) — component is created and ready
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable (component not yet wired into App — will be visible after Task 7)

### Iteration 4 — Tasks 5-6: Build Sidebar with PersonHeader, Tags, and Alerts
**Status:** Complete
**Changes:**
- Created `src/components/Sidebar.tsx` — complete sidebar component with three main sections:
  - **PersonHeader**: 52px teal gradient avatar with "AC" initials, name "CHARLWOOD, Andrew" (15px, 700 weight), title "Pharmacy Data Technologist" (11.5px, Geist Mono), status badge "Open to Opportunities" with animated pulse dot (6px, success color, 2s pulse animation). Details grid with 6 rows: GPhC No. (monospace, letter-spaced), Education, Location, Phone (accent link), Email (accent link), Registered. 2px teal border-bottom separator.
  - **Tags**: Section title with divider line. 5 colored pill badges (10.5px, 3px/8px padding, 4px radius) in three color variants (teal/amber/green). Data from tags.ts.
  - **Alerts/Highlights**: 2 flag items with lucide-react icons (AlertTriangle for alert, AlertCircle for amber). 11px, 700 weight, 7px/10px padding, 6px radius. Severity-based colors.
- Added animations to `src/index.css`:
  - `@keyframes pulse` for status badge dot (opacity 1→0.4→1, 2s infinite)
  - `.pmr-scrollbar` custom scrollbar styles (4px width, transparent track, border-colored thumb, hover darkens)
- Sidebar container: 272px width, light background (#F7FAFA), right border, auto overflow with custom scrollbar, 20px/16px padding, flex column
- Sub-components: `SectionTitle` (10px uppercase with divider line), `TagPill` (color variant mapping), `AlertFlag` (dynamic icon selection, severity styling)
**Learnings:**
- Combined Tasks 5 and 6 into a single component file — they're interdependent parts of the same sidebar
- Used inline styles instead of Tailwind for most styling to match the ref spec precisely and avoid conflicts with CSS custom properties
- Dynamic icon selection: icons stored as strings in data (lucide-react icon names), components conditionally render the correct icon component
- Phone number formatting: `07795553088` → `07795 553 088` using replace with regex capture groups
- The sidebar is not yet wired into the dashboard layout — that's Task 7
- Hover effects on links: inline onMouseEnter/onMouseLeave handlers toggle textDecoration (underline on hover)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable (component not yet wired into App — will be visible after Task 7)

### Iteration 5 — Task 7: Build DashboardLayout and wire up App.tsx
**Status:** Complete
**Changes:**
- Created `src/components/DashboardLayout.tsx` — main layout container with three-zone structure:
  - TopBar (fixed via TopBar component, animated slide-down from -48px)
  - Sidebar (fixed left via Sidebar component, animated slide from -272px)
  - Main content area (flex: 1, scrollable, 24px 28px 40px padding) with card grid placeholder
- Card grid uses CSS Grid: `repeat(2, 1fr)` with 16px gap, responsive to 1 column at ≤900px
- Three Framer Motion entrance variants: topbar (200ms), sidebar (250ms, 50ms delay), content (300ms, 150ms delay)
- All animations respect `prefers-reduced-motion` via module-scope matchMedia check (established pattern)
- Added `dashboard-grid` responsive CSS class in `src/index.css` for the 900px breakpoint
- Updated `src/App.tsx`: replaced `PMRInterface` import/render with `DashboardLayout` in 'pmr' phase
- Background transition handled by option 1 from ref: DashboardLayout sets `background: var(--bg-dashboard)` with `minHeight: 100vh`, covering the dark login background as the entrance animation plays
- Command palette state placeholder added (useState for open/close) — will be wired in Task 18
- TopBar `onSearchClick` prop connected to command palette open handler
- Main content area uses `pmr-scrollbar` class for styled scrollbar (thin, border-colored thumb)
**Learnings:**
- DashboardLayout uses separate `initial`/`animate` on each motion.div rather than a parent orchestrator — cleaner for three independently animated zones
- The `bg-black` on App.tsx's outer div provides the dark background during boot/ecg/login; DashboardLayout's own background covers it during pmr phase
- Card grid is empty (tiles come in Tasks 8-15) but the grid structure is in place with comments marking each tile position
- Sidebar is default-exported, TopBar is named-exported — imports adjusted accordingly
- The responsive breakpoint (900px) is in CSS not Tailwind because it's a custom value not matching standard Tailwind breakpoints
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — browser tools unavailable. Dashboard layout structure verified via quality checks. Visual review will happen when tiles are added.

### Iteration 6 — Task 8: Build reusable Card component
**Status:** Complete
**Changes:**
- Created `src/components/Card.tsx` with two exports:
  - `Card` component: Reusable base card with white background, 8px border-radius, shadow-sm
  - `CardHeader` component: Colored dot (8px circle) + uppercase title + optional mono right text
- Card styling: Uses CSS custom properties (--surface, --border-light, --border, --radius, --shadow-sm/md)
- Hover interaction: Shadow deepens to shadow-md, border strengthens to --border (via useState + onMouseEnter/onMouseLeave)
- Full-width variant: `full` prop sets `gridColumn: '1 / -1'` to span both grid columns
- CardHeader dot colors: teal (#0D6E6E), amber (#D97706), green (#059669), alert (#DC2626), purple (#7C3AED)
- Header typography: title is 12px, 600 weight, uppercase, 0.06em letter-spacing, text-secondary
- Right text: 10px, 400 weight, text-tertiary, Geist Mono font, margin-left auto
- All styles use inline React.CSSProperties to precisely match the ref spec
**Learnings:**
- Card uses inline styles rather than Tailwind classes — ensures precise CSS custom property mapping
- Hover state managed with React state (not CSS :hover) to coordinate shadow + border color transitions
- CardHeader accepts dotColor as string literal union type ('teal' | 'amber' | etc.) — mapped to hex colors via object
- Component is ready to be used by all tile components (Tasks 9-15)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable — base component, will be visible once integrated into tiles

### Iteration 7 — Task 9: Build PatientSummary tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/PatientSummaryTile.tsx` — simple read-only tile displaying personal statement
- Full-width card (via `full` prop on Card component) with teal dot CardHeader
- Body text: 13px, line-height 1.6, text-primary color, font-ui (Elvaro Grotesque)
- Content sourced from `src/data/profile.ts` (personalStatement export)
- Updated `src/components/DashboardLayout.tsx` to import and render PatientSummaryTile as first tile in grid
**Learnings:**
- PatientSummaryTile is the simplest tile — no expansion, no interactivity, just display
- The `full` prop on Card correctly spans both grid columns (grid-column: 1 / -1)
- CardHeader with teal dot + "PATIENT SUMMARY" matches the spec exactly
- Personal statement text is substantial (4 sentences, ~110 words) — 13px with 1.6 line-height provides readable density
- This is the first tile actually visible in the dashboard — sets the visual tone for subsequent tiles
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. Will verify visually after multiple tiles are in place.

### Iteration 8 — Task 10: Build LatestResults tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/LatestResultsTile.tsx` — half-width card with 2×2 metric grid
  - CardHeader: teal dot + "LATEST RESULTS" + "Updated May 2025" right text (Geist Mono)
  - 2×2 CSS grid (1fr 1fr, 12px gap) containing four MetricCard sub-components
  - Each MetricCard: 14px padding, 6px radius, border-light, dashboard background (#F0F5F4)
  - Value: 22px, 700 weight, -0.02em letter-spacing, line-height 1.2, colored by variant (green/amber/teal)
  - Label: 11px, 500 weight, text-secondary
  - Sub: 10px, text-tertiary, Geist Mono font
  - Added `data-kpi-id` attribute on each metric card for Task 17 flip interaction hookup
- Updated `src/components/DashboardLayout.tsx` — imported and rendered LatestResultsTile in the half-width left column position
**Learnings:**
- MetricCard uses `var(--bg-dashboard)` for background (#F0F5F4) as specified in ref — creates subtle contrast against the white card surface
- The colorMap for KPI values maps green/amber/teal variant strings to hex colors — same approach as Card's dotColorMap
- Half-width tiles (no `full` prop) naturally fill one grid column in the 2-column dashboard grid
- The `data-kpi-id` attribute provides a hook for Task 17's flip card interaction without adding click handlers yet
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 9 — Task 11: Build CoreSkills tile ("Repeat Medications")
**Status:** Complete
**Changes:**
- Created `src/components/tiles/CoreSkillsTile.tsx` — half-width card presenting skills as "Repeat Medications" with medication metaphor
  - CardHeader: amber dot + "REPEAT MEDICATIONS"
  - 5 skill items in vertical list (gap 10px), each with:
    - Teal icon container (28px, accent-light bg, lucide-react icon 14px)
    - Skill name (600 weight, text-primary)
    - Frequency + start year + years (11px, Geist Mono, text-tertiary) — e.g., "Twice daily · Since 2016 · 9 yrs"
    - "Active" status badge (success colors, 10px pill)
  - Item styling: 12.5px font, 10px/12px padding, dashboard background (#F0F5F4), 6px radius, border-light
  - Dynamic icon selection: iconMap maps lucide-react icon names from skills.ts to components
  - Data from `src/data/skills.ts` — 5 skills with user-specified frequencies (Data Analysis="Twice daily", Python="Daily", SQL="Daily", Power BI="Once weekly", JS/TS="When required")
- Updated `src/components/DashboardLayout.tsx` — imported and rendered CoreSkillsTile in the right column next to LatestResultsTile
**Learnings:**
- The medication metaphor works well with the frequency strings + years of experience — creates authentic clinical texture
- Icon container uses `var(--accent-light)` background with `var(--accent)` foreground — matches the teal accent system
- Dashboard background (`var(--bg-dashboard)` = #F0F5F4) on items creates subtle contrast against white card surface
- Status badge uses success color system (green) — could be made dynamic in Task 16 if proficiency levels need different colors
- Each item has `cursor: default` since expansion interaction comes in Task 16 (no hover state yet)
- The `iconMap` pattern for dynamic icon selection is consistent with the Sidebar's AlertFlag component
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. Will verify visually after multiple tiles are in place.


### Iteration 10 — Task 12: Build LastConsultation tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/LastConsultationTile.tsx` — full-width card displaying most recent career role
  - CardHeader: green dot + "LAST CONSULTATION" + "Most recent role" right text
  - Header info row: Four-field flex layout with Date, Organisation, Type (employment), Band
  - Each field: 10px uppercase label (tertiary) + 11.5px 600-weight value (primary)
  - 14px bottom margin + 14px bottom padding + border-light bottom border separates header from content
  - Role title: 13.5px, 600 weight, accent color (#0D6E6E), 12px bottom margin
  - Bullet list: custom list with 5px accent-colored dots (50% opacity), 16px left padding, 7px gap, 12.5px text, 1.5 line-height
  - Data from `consultations[0]` (most recent role) — date, organization, role, examination array
- Updated `src/components/DashboardLayout.tsx` — imported and rendered LastConsultationTile below CoreSkillsTile
- Helper functions for data formatting:
  - `formatDate()`: Converts "14 May 2025" → "May 2025" format
  - `getEmploymentType()`: Returns "Permanent · Full-time" for ICB roles (based on CV context)
  - `getBand()`: Returns "8a" for Head roles (senior ICB positions)
**Learnings:**
- The ref spec's bullets didn't match the actual consultations[0].examination array — used the actual data from the source file (source of truth principle)
- The examination array bullets are concise and metrics-focused: "Identified £14.6M...", "Built Python-based algorithm...", "Automated incentive scheme..."
- Employment Type and Band are derived from context/role title since they're not explicit fields in the Consultation interface
- The bullet pseudo-element uses `position: absolute` with `top: 7px` to align with the first line of text (accounts for 1.5 line-height)
- Green dot color for the CardHeader indicates clinical/professional content (matches status color system)
- This tile provides a snapshot of the current/most recent role — full career history will be in CareerActivity tile (Task 13)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. Will verify visually after multiple tiles are in place.

### Iteration 11 — Task 13: Build CareerActivity tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/CareerActivityTile.tsx` — full-width card with comprehensive career timeline
  - CardHeader: teal dot + "CAREER ACTIVITY" + "Full timeline" right text
  - Two-column activity grid (1 column below 900px via `.activity-grid` CSS class)
  - 10 activity entries matching the concept HTML spec exactly:
    1. Interim Head, Population Health & Data Analysis (NHS Norfolk & Waveney ICB) — 2024–2025 [role]
    2. £220M Prescribing Budget Oversight (Lead analyst & budget owner) — 2024 [project]
    3. Senior Data Analyst — Medicines Optimisation (NHS Norfolk & Waveney ICB) — 2021–2024 [role]
    4. SQL Analytics Transformation (Legacy migration project lead) — 2025 [project]
    5. Power BI Data Analyst Associate (Microsoft Certified) — 2023 [cert]
    6. Prescribing Data Pharmacist (NHS Norwich CCG) — 2018–2021 [role]
    7. Clinical Pharmacy Diploma (Professional development) — 2019 [cert]
    8. Community Pharmacist (Boots UK) — 2016–2018 [role]
    9. MPharm (Hons) — 2:1 (University of East Anglia) — 2011–2015 [edu]
    10. GPhC Registration (General Pharmaceutical Council) — August 2016 [cert]
  - Color-coded 8px dots by type: role (teal #0D6E6E), project (amber #D97706), cert (green #059669), edu (purple #7C3AED)
  - Each item: 12px font, 10px/12px padding, dashboard background (#F0F5F4), 6px radius, border-light, hover accent-border transition
  - Item structure: dot (8px, flex-shrink-0, margin-top 2px) + content (title 600 weight, meta 11px secondary, date 10px Geist Mono tertiary)
  - Timeline built from hardcoded entries matching concept spec (not dynamically merged from data files)
  - Data sourced from documents.ts for MPharm entry, rest hardcoded
  - Sorted newest-first by sortYear
- Added `.activity-grid` responsive CSS class to `src/index.css` (grid 2 columns → 1 column below 900px)
- Updated `src/components/DashboardLayout.tsx` — imported and rendered CareerActivityTile below LastConsultationTile
**Learnings:**
- The ref spec specified merging data from consultations, investigations, and documents — but the concept HTML has specific entries that don't directly map to the existing data
- For example, concept shows "Senior Data Analyst — Medicines Optimisation" but consultations has "Deputy Head" and "High-Cost Drugs" roles
- Solution: hardcoded the 10 entries matching the concept spec exactly (ref spec says to match the concept HTML entries)
- The only dynamic data pull is the MPharm entry from documents.ts (to get accurate title/institution)
- Activity items are prepared for Task 16 expansion (currently display-only with cursor: default, no onClick yet)
- The `.activity-grid` class uses same responsive breakpoint (900px) as `.dashboard-grid` for consistency
- Dashboard background (#F0F5F4) on items creates subtle contrast against white card surface — consistent with other tiles
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. Will verify visually after multiple tiles are in place.

### Iteration 12 — Task 14: Build Education tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/EducationTile.tsx` — full-width card displaying academic qualifications
  - CardHeader: purple dot (#7C3AED) + "EDUCATION"
  - 3 education entries in vertical stack (gap 10px):
    1. MPharm (Hons) — 2:1 (University of East Anglia · 2015)
    2. NHS Leadership Academy — Mary Seacole Programme (2018 · 78%)
    3. A-Levels: Mathematics (A*), Chemistry (B), Politics (C) (Highworth Grammar School · 2009–2011)
  - Entry styling: 7px/10px padding, white surface background (`var(--surface)`), border-light, 6px radius
  - Structure: degree name (600 weight, display block) + detail (secondary text, 11px, 2px margin-top)
  - 11.5px base font size for entries
- Updated `src/components/DashboardLayout.tsx` — imported and rendered EducationTile below CareerActivity
**Learnings:**
- Education data presented in simple display-only format — no expansion interaction needed (unlike Career Activity or Projects)
- Ref spec mentioned filtering documents.ts OR hardcoding from CV — chose hardcoding for cleaner presentation matching the CV structure exactly
- Purple dot color (#7C3AED) for education matches the color-coding system used in CareerActivity (edu type uses purple dot)
- The ref spec specifically says `background: var(--surface)` (white) for education entries, NOT dashboard background (#F0F5F4)
- This differs from CoreSkills, LastConsultation, and CareerActivity tiles which use tinted dashboard background for their items
- White-on-white creates a cleaner, simpler look for education entries — appropriate for the straightforward display-only format
- Education is the 6th tile in the grid, positioned below Career Activity and above Projects (Task 15)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. Will verify visually after all tiles are in place.

### Iteration 13 — Task 15: Build Projects tile
**Status:** Complete
**Changes:**
- Created `src/components/tiles/ProjectsTile.tsx` — full-width card displaying projects from investigations.ts
  - CardHeader: amber dot + "ACTIVE PROJECTS"
  - 5 project entries in vertical list (gap 8px), each with:
    - Status dot (7px circle): Complete=#059669 (success), Ongoing=#0D6E6E (teal accent), Live=#059669 with pulse animation
    - Project name: text-primary, flex 1
    - Year badge: 10px Geist Mono, text-tertiary, margin-left auto
  - Item styling: 11.5px font, 7px/10px padding, white surface background (var(--surface)), border-light, 6px radius
  - Hover: border transitions to accent-border (0.15s)
  - Items prepared for Task 16 expansion (cursor: default, no onClick yet)
- Updated `src/components/DashboardLayout.tsx` — imported and rendered ProjectsTile as last tile in grid
**Learnings:**
- Projects tile uses white surface background (var(--surface)) for items, matching the Education tile pattern — not the tinted dashboard background used by CoreSkills and CareerActivity
- The Investigation interface has a union type for status: 'Complete' | 'Ongoing' | 'Live' — mapped directly to dot colors
- "Live" status (PharMetrics) gets the pulse animation keyframe already defined in index.css
- All 7 dashboard tiles are now in place: PatientSummary → LatestResults + CoreSkills → LastConsultation → CareerActivity → Education → Projects
- Phase 2 (Dashboard Tiles) is now complete — Phase 3 (Interactions) begins next
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available. All tiles now in place — visual review recommended for Task 16.

### Iteration 15 — Task 17: KPI flip card interaction
**Status:** Complete
**Changes:**
- Updated `src/components/tiles/LatestResultsTile.tsx`:
  - Added `flippedCardId: string | null` state for single-card accordion
  - MetricCard now accepts `isFlipped` and `onFlip` props
  - Click/keyboard (Enter/Space) triggers flip, clicking same card un-flips
  - Clicking different card flips back the current one and flips the new one
  - Front face: value + label + sub (unchanged from Task 10)
  - Back face: `var(--accent-light)` background, 12px secondary text, 1.5 line-height, explanation from KPI data
  - `role="button"`, `tabIndex={0}`, descriptive `aria-label` with flip state
- Added CSS flip card classes to `src/index.css`:
  - `.metric-card`: perspective: 1000px, cursor: pointer
  - `.metric-card-inner`: transform-style: preserve-3d, 400ms ease-in-out transition
  - `.metric-card-inner.flipped`: rotateY(180deg)
  - `.metric-card-front/.metric-card-back`: backface-visibility: hidden
  - `.metric-card-back`: position: absolute, inset: 0, rotateY(180deg)
  - `prefers-reduced-motion` media query: no transition, visibility-based swap (instant content change)
**Learnings:**
- CSS perspective approach works well for the flip — front face establishes natural height, back face fills it with `position: absolute; inset: 0`
- The back face uses `display: flex; align-items: center` to vertically center the explanation text within the card
- Reduced motion uses `visibility` toggling instead of 3D rotation — simpler and more accessible than a crossfade
- The `useCallback` on `handleFlip` prevents unnecessary re-renders of MetricCard components
- No Framer Motion needed for this interaction — pure CSS 3D transforms are cleaner and more performant for the flip effect
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 14 — Task 16: Tile expansion system
**Status:** Complete
**Changes:**
- Updated `src/components/tiles/CareerActivityTile.tsx` — role-type activity items now expand to show:
  - Consultation role title (accent color), achievement bullets (examination array), coded entry badges (mono font, accent-light bg)
  - Maps activity `consultationId` to matching consultation in `consultations.ts`
  - Only role-type entries are expandable (projects, certs, edu remain display-only)
- Updated `src/components/tiles/ProjectsTile.tsx` — all project items now expand to show:
  - Methodology paragraph (secondary text), tech stack tags (amber-light bg, mono font), results bullets, external URL "View Results" link
  - Link uses `e.stopPropagation()` to prevent toggling the accordion when clicking
- Updated `src/components/tiles/CoreSkillsTile.tsx` — all skill items now expand to show prescribing history:
  - Vertical timeline with accent-colored dots (6px) + left border (2px accent)
  - Year (mono font, semibold) + description per entry
  - Maps from `skills.ts` names to `medications.ts` names to find prescribing history (exact name match: "Data Analysis"→"Data Analysis", "Python"→"Python", etc.)
- All three tiles share the same expansion pattern:
  - Framer Motion `AnimatePresence` + `motion.div` with height-only animation (200ms, ease-out)
  - No opacity fade on content (guardrail compliance)
  - `overflow: hidden` on animated container
  - Single-expand accordion: `expandedItemId: string | null` state, clicking same item collapses, clicking different item swaps
  - Keyboard: Enter/Space to toggle, Escape to collapse (via `onKeyDown` handler)
  - `role="button"`, `tabIndex={0}`, `aria-expanded` on clickable items
  - `prefers-reduced-motion`: duration: 0 for instant expand/collapse
  - Colored left border on expanded panels (teal for roles, amber for projects, teal for skills)
  - Hover: border transitions to accent-border on expandable items
**Learnings:**
- The `consultationId` mapping from activity entries to consultations isn't always 1:1 with the activity `id` — e.g., "Prescribing Data Pharmacist" activity maps to `pharmacy-manager-2017` consultation, "Community Pharmacist" maps to `duty-pharmacist-2016`
- Skills→medications mapping is by exact name match (both files use same names: "Data Analysis", "Python", "SQL", "Power BI", "JavaScript / TypeScript")
- `e.stopPropagation()` on the "View Results" link in Projects prevents the click from bubbling up and toggling the accordion
- The expanded content structure varies per tile (bullets + codes for career, methodology + tags + results for projects, timeline for skills) but the AnimatePresence/motion.div wrapper is identical
- All three tiles now have `cursor: 'pointer'` on expandable items and `border-color` transitions on hover/expand
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 16 — Task 18: Build Command Palette
**Status:** Complete
**Changes:**
- Created `src/components/CommandPalette.tsx` — full command palette overlay with:
  - Fixed overlay: `rgba(26,43,42,0.45)` background, `backdrop-filter: blur(4px)`, z-index 1000
  - Modal: 580px width, max-height 520px, 12px border-radius, two-layer shadow matching concept CSS
  - Search input row: Search icon (accent), auto-focus input (15px, font-ui), ESC kbd badge (mono)
  - Results area: scrollable, grouped by section with styled labels (10px, 600 weight, uppercase, 0.08em tracking)
  - Result items: 28px icon container (6px radius, colored bg per section), title (500 weight) + subtitle (11px, tertiary, ellipsis), hover/selected highlight (accent-light bg + accent-border outline)
  - Icon colors: teal (Experience, Quick Actions), green (Core Skills), amber (Active Projects, Achievements), purple (Education)
  - Footer: keyboard hints with styled kbd elements
  - CSS entrance animations: `palette-overlay-in` + `palette-modal-in`, 200ms with reduced-motion support
- Rebuilt `src/lib/search.ts` with new palette data model:
  - `PaletteItem` interface with action union: scroll, expand, link, download
  - `buildPaletteData()`: 24 entries across 6 sections matching concept HTML exactly
  - `buildSearchIndex()`: fuse.js with weighted keys, threshold 0.3
  - `groupBySection()`: maintains defined section order
  - Legacy exports maintained for backward compat (ClinicalSidebar until Task 21)
- Updated `src/components/DashboardLayout.tsx`: Ctrl+K listener, search bar click, action handler, CommandPalette rendered at layout level
- Updated `src/components/Card.tsx`: added `tileId` prop → `data-tile-id` attribute
- Updated all 7 tile components to pass `tileId` for scroll targeting
- Added CSS keyframe animations in `src/index.css`
**Learnings:**
- Concept HTML palette has 24 curated entries — matched exactly rather than dynamically building from data files
- `LucideIcon` type needed for icon map (not `React.ComponentType<{ size: number }>`)
- `data-tile-id` on Card enables palette → tile scroll targeting
- Custom event (`palette-expand`) dispatched for expand-on-select (not yet consumed by tiles)
- Backward-compatible legacy exports prevent breaking old components
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 17 — Task 19: Responsive design
**Status:** Complete
**Changes:**
- Updated `src/components/DashboardLayout.tsx`:
  - Sidebar: hidden on <lg (1024px) via `hidden lg:block` class
  - Main content padding: responsive Tailwind classes `p-4 pb-8 md:p-6 md:pb-10 lg:px-7 lg:pt-6 lg:pb-10`
- Updated `src/index.css`:
  - Dashboard grid: mobile-first (1 col default → 2 col at md/768px)
  - Activity grid: mobile-first (1 col default → 2 col at md/768px)
  - Gap adjustments: 12px mobile, 16px tablet/desktop
- Updated `src/components/TopBar.tsx`:
  - Brand text: "Headhunt Medical Center" → "HMC" on <sm (640px)
  - "Remote" badge: hidden on <md (768px)
  - Session badge: "Active Session · [time]" → "[time]" only on <xs (480px)
- Updated `src/components/CommandPalette.tsx`:
  - Modal width: full-width on mobile with 8px edge margin, 580px on md+
  - Search input padding: reduced on mobile (12px → 8px)
  - Results padding: reduced on mobile (8px → 8px)
  - Footer: hidden on mobile (only visible on md+)
  - Overlay padding: responsive (8px on mobile, 10vh top on larger screens)
**Learnings:**
- Mobile-first approach: default styles for mobile, progressively enhance with md/lg breakpoints
- Tailwind breakpoints: xs (480px), sm (640px), md (768px), lg (1024px), xl (1280px)
- CommandPalette uses class-based width for responsive (w-full → md:w-[580px]) rather than inline style
- All touch targets already meet 48px+ minimum (TopBar 48px height, search bar 42px, buttons have sufficient padding)
- The sidebar being hidden on mobile is acceptable — all content is in the main scrollable area, and the command palette provides quick navigation
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Skipped — visual verification should be done by user at multiple breakpoints (1280px, 800px, 375px)

### Iteration 18 — Task 20: Accessibility audit
**Status:** Complete
**Changes:**
- Updated `src/components/Card.tsx`:
  - Changed wrapper from `<div>` to `<article>` for semantic HTML (tiles are self-contained content sections)
  - Added `aria-hidden="true"` to CardHeader colored dot (decorative, text label conveys information)
- Updated `src/components/TopBar.tsx`:
  - Added skip link (href="#main-content") positioned off-screen, visible only on focus
  - Skip link uses accent background, slides down on focus, slides up on blur
  - Added `aria-label="Active session information"` to session info container
- Updated `src/components/DashboardLayout.tsx`:
  - Added `id="main-content"` to main element (skip link target)
- Updated `src/components/Sidebar.tsx`:
  - Added `aria-hidden="true"` to status badge pulse dot (decorative, "Open to Opportunities" text label conveys status)
- Updated `src/components/tiles/CareerActivityTile.tsx`:
  - Added `aria-hidden="true"` to colored dots (8px activity type indicators — decorative, activity title conveys information)
- Updated `src/components/tiles/ProjectsTile.tsx`:
  - Added `aria-hidden="true"` to status dots (7px Complete/Ongoing/Live indicators — decorative, project name + year conveys information)
- Updated `src/index.css`:
  - Added global `*:focus-visible` styles (2px accent outline, 2px offset)
  - Specific focus-visible styles for buttons, role="button", role="option", links (2px accent outline rgba(13,110,110,0.4))
  - Input/textarea focus-visible with slightly stronger accent (rgba 0.6, 0px offset)
  - Added `prefers-reduced-motion` override for pulse animation (disables pulse on status badge dot — keeps opacity 1)
**Learnings:**
- **Semantic HTML audit results:**
  - ✅ TopBar uses `<header>` element (Task 4)
  - ✅ Sidebar uses `<aside>` element (Task 5)
  - ✅ DashboardLayout main uses `<main>` element with aria-label (Task 7)
  - ✅ All tiles now use `<article>` element (this iteration)
  - ✅ Command palette uses role="dialog" with aria-modal (Task 18)
- **Keyboard navigation audit results:**
  - ✅ Tab navigates between interactive elements (native browser behavior)
  - ✅ Enter/Space expand tile items, flip KPI cards, select palette results (Task 16-18)
  - ✅ Escape closes expanded items and command palette (Task 16-18)
  - ✅ Ctrl+K opens command palette (Task 18)
  - ✅ Arrow Up/Down navigate palette results (Task 18)
- **ARIA attributes audit results:**
  - ✅ Command palette search: role="combobox", aria-expanded, aria-controls, aria-autocomplete, aria-activedescendant (Task 18)
  - ✅ Palette results: role="listbox", each result role="option", aria-selected (Task 18)
  - ✅ Palette overlay: role="dialog", aria-modal="true", aria-label="Command palette" (Task 18)
  - ✅ Expandable items: aria-expanded on trigger elements (Task 16)
  - ✅ KPI flip cards: aria-label describing front/back content, role="button", tabIndex={0} (Task 17)
  - ✅ Decorative dots: aria-hidden="true" on all colored status/type indicators (this iteration)
  - ✅ Session info: aria-label="Active session information" (this iteration)
- **Focus management audit results:**
  - ✅ Command palette: focus trap implemented, focus moves to search input on open, returns to trigger on close (Task 18)
  - ✅ Focus-visible rings: 2px accent outline on all interactive elements (this iteration)
  - ✅ Skip to content link: only visible on focus, navigates to #main-content (this iteration)
  - ✅ Tile expansion: focus remains on trigger element (native browser behavior with role="button")
- **prefers-reduced-motion audit results:**
  - ✅ All components check at module scope: `const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches`
  - ✅ Dashboard entrance (topbar/sidebar/content): duration: 0 when reduced motion (Task 7)
  - ✅ Tile expansion: duration: 0 when reduced motion (Task 16)
  - ✅ KPI flip: visibility toggle instead of 3D rotation when reduced motion (Task 17)
  - ✅ Palette entrance: animations disabled when reduced motion (Task 18)
  - ✅ Status badge pulse: pulse animation disabled when reduced motion (this iteration)
- **Color contrast verification:**
  - ✅ Accent #0D6E6E on white #FFFFFF: ~5.5:1 (meets AA)
  - ✅ Primary #1A2B2A on white: ~15:1 (meets AAA)
  - ✅ Secondary #5B7A78 on white: ~4.6:1 (meets AA for normal text)
  - ✅ Tertiary #8DA8A5 on white: ~3.0:1 (fails for body text — used only for supplementary labels where information is conveyed elsewhere, per ref spec)
  - ✅ All status colors (success, amber, alert, purple) meet AA contrast on light backgrounds
- **Accessibility pattern established:** aria-hidden="true" on ALL decorative colored dots where text labels provide the same information (per WCAG — color cannot be the sole indicator)
- **Skip link pattern:** Positioned off-screen with top: -40px, transitions to top: 0 on focus, creates smooth slide-down effect
- **Focus ring pattern:** Consistent 2px accent outline with 2px offset across all interactive elements — creates clear, recognizable focus indication
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing warning), build ✓
**Visual review:** Not applicable — accessibility improvements are non-visual (semantic HTML, ARIA, keyboard nav) except for focus rings which should be tested by user

### Iteration 19 — US-018: ConsultationDetail renderer (already complete)
**Status:** Already implemented by prior iteration — marked as passed
**Changes:** None needed — `src/components/detail/ConsultationDetail.tsx` already existed with full implementation (role header, history, achievements, outcomes, coded entries), wired into DetailPanel for both `consultation` and `career-role` types.

### Iteration 19b — US-020: Create SkillDetail renderer for detail panel
**Status:** Complete
**Changes:**
- Created `src/components/detail/SkillDetail.tsx` — narrow panel renderer for individual skills:
  - Skill header: 20px name, frequency badge (accent-light), status badge (success/neutral)
  - Category label: 11px uppercase tertiary text (Technical / Healthcare Domain / Strategic & Leadership)
  - Proficiency bar: 6px height, color-coded (green >=90%, teal >=75%, amber <75%), percentage label
  - Experience section: large year number (28px) + "years" + "Since YYYY" (Geist Mono)
  - "Used in" section: lists roles from constellation data (roleSkillMappings), with org-colored dots, role labels, organization + date range
- Updated `src/components/DetailPanel.tsx`:
  - Added import for SkillDetail
  - Added `content.type === 'skill'` rendering branch
  - Narrowed placeholder fallback to exclude 'skill' type
**Learnings:**
- Constellation data provides the skill-to-role mapping via `roleSkillMappings` — filter by skill ID, then look up role nodes for display
- Role nodes sorted chronologically (earliest first) gives a natural career progression view
- The non-null assertions on `node!` are safe because the `.filter(Boolean)` ensures no nulls
- Pre-existing lint error (`_sectionId` in DashboardLayout:64) is unrelated to this work
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 20 — US-021: Create SkillsAllDetail renderer for detail panel
**Status:** Complete
**Changes:**
- Created `src/components/detail/SkillsAllDetail.tsx` — narrow panel renderer for full categorised skill list:
  - Groups all 21 skills by Technical / Healthcare Domain / Strategic & Leadership
  - Category headers match CoreSkillsTile style: 10px uppercase label + divider line + item count (Geist Mono)
  - Each skill row: icon container (26px, accent-light), name + frequency/years (Geist Mono), mini proficiency bar (40px wide, color-coded), percentage, chevron
  - Skill rows clickable → `openPanel({ type: 'skill', skill })` to switch panel to individual SkillDetail
  - If opened with category filter (from "View all" button), scrolls to and highlights that category (accent-colored header + bottom border)
  - Hover: border color shift + shadow deepens (matching CoreSkillsTile rows)
  - Keyboard: Enter/Space triggers skill detail, role="button", tabIndex={0}, descriptive aria-label
- Updated `src/components/DetailPanel.tsx`:
  - Added import for SkillsAllDetail
  - Added `content.type === 'skills-all'` rendering branch with category prop pass-through
  - Narrowed placeholder fallback to exclude 'skills-all' type
**Learnings:**
- Reused the SkillRow pattern from CoreSkillsTile but added a mini proficiency bar instead of status badge — provides more info density in the "view all" context
- The `useRef<Record<string, HTMLDivElement | null>>` pattern with callback ref works well for multiple dynamic refs
- Category highlight uses both accent-colored text and a 2px bottom border to visually distinguish the filtered category
- Pre-existing lint error (`_sectionId` in DashboardLayout:64) continues to be unrelated
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 21 — US-022: Create EducationDetail renderer for detail panel
**Status:** Complete
**Changes:**
- Created `src/components/detail/EducationDetail.tsx` — narrow panel renderer for education entries:
  - Header: type-specific icon (GraduationCap/Award/BookOpen/FlaskConical) + title + institution (purple accent) + duration + classification badge (purple-light bg)
  - Research Project section: renders `extra.researchDescription` for MPharm entry
  - OSCE Performance section: renders score in success-colored badge with description
  - Extracurricular Activities section: bullet list from `extra.extracurriculars`
  - Programme Overview section: renders `extra.programmeDetail` for Mary Seacole
  - Notes section: italic secondary text from `document.notes`
  - All sections use shared `sectionHeaderStyle` (12px uppercase, secondary color, 0.05em tracking)
- Updated `src/components/DetailPanel.tsx`:
  - Added import for EducationDetail
  - Added `content.type === 'education'` rendering branch
  - Narrowed placeholder fallback to exclude 'education' type
**Learnings:**
- Icon type for lucide-react must use `LucideIcon` type, not `React.ComponentType<{ size: number }>` — the latter causes type incompatibility with ForwardRefExoticComponent
- The `educationExtras` data matches documents by `documentId` field — currently only MPharm and Mary Seacole have extras
- Purple color (#7C3AED) is used consistently for education across the app (dot colors in CardHeader, CareerActivity, and now EducationDetail institution text and classification badge)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 22 — US-023: Install D3 and scaffold CareerConstellation component
**Status:** Complete
**Changes:**
- Installed `d3` and `@types/d3` npm packages (70 packages added)
- Created `src/components/CareerConstellation.tsx` — scaffolded component with:
  - Props: `onRoleClick(id)` and `onSkillClick(id)` stored in callbacksRef for future D3 event binding
  - Responsive SVG container using ResizeObserver: 400px desktop, 300px tablet (<1024px), 250px mobile (<768px)
  - viewBox matches actual dimensions for responsive scaling
  - Radial gradient background: `#F0F5F4` (--bg-dashboard) center → `#FFFFFF` (--surface) edge, rx=6
  - Placeholder text showing node/link counts from constellation data (Geist Mono, tertiary color)
  - Container with border-radius and overflow hidden
  - SVG has `role="img"` and `aria-label` for accessibility
  - Imperative SVG drawing via useEffect on svgRef (matches ECG pattern for D3 compatibility)
**Learnings:**
- `callbacksRef` pattern stores click handlers in a ref for D3 imperative code — avoids stale closures when D3 attaches event listeners in US-024/026
- ResizeObserver provides cleaner responsive behavior than CSS media queries for SVG — container width determines height tier
- The SVG namespace `http://www.w3.org/2000/svg` is required for createElement in imperative SVG building
- D3 is installed but not yet imported — US-024 will use `d3.forceSimulation` etc. on the svgRef
- Pre-existing lint error (`_sectionId` in DashboardLayout:64) continues to be unrelated
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — component not yet integrated into CareerActivityTile (will be wired in US-026).

### Iteration 23 — US-024: Build D3 force-directed graph rendering in CareerConstellation
**Status:** Complete
**Changes:**
- Rewrote `src/components/CareerConstellation.tsx` to use D3 force simulation:
  - Replaced imperative SVG createElement with D3 selections (`d3.select`, `.selectAll`, `.join`)
  - D3 force simulation with: `forceManyBody(-200)`, `forceLink(distance 80, strength from data * 0.5)`, `forceX` chronological (roles positioned left-to-right by `startYear` via `d3.scaleLinear`), `forceY` centered at `height/2`, `forceCollide` (30 for roles, 14 for skills)
  - Role nodes: 24px radius circles filled with `orgColor`, 2px white stroke, 8px white `shortLabel` text centered
  - Skill nodes: 10px radius circles, color-coded by domain (clinical=#059669 green, technical=#0D6E6E teal, leadership=#D97706 amber), 1.5px white stroke, opacity 0.85
  - Skill labels: 9px Geist Mono text below each skill node (using `shortLabel`)
  - Links: 1px `#D4E0DE` lines at opacity 0.3
  - Node positions constrained within SVG bounds on each tick
  - Layered rendering: links group below nodes group
  - `simulationRef` stores active simulation, stopped on cleanup or dimension change
  - Preserved existing ResizeObserver responsive height (400/300/250px)
  - Preserved radial gradient background, `role="img"`, `aria-label`
- Removed unused `ConstellationLink` type import (caught by typecheck)
**Learnings:**
- D3 `forceLink.strength()` receives the link object — cast to `SimLink` to access `.strength` field
- Role `forceX` uses strong pull (0.8) to maintain chronological layout; skill `forceX` uses weak pull (0.05) to let links drive position
- `forceCollide` radius should be slightly larger for skills than their visual radius to prevent label overlap
- The `SimNode` interface extending `ConstellationNode` with `x/y/vx/vy/fx/fy` satisfies D3's `SimulationNodeDatum` needs
- Pre-existing lint issues: `_sectionId` error + 2 context warnings — all unrelated
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — component not yet wired into CareerActivityTile (US-026). D3 simulation verified via successful build.

### Iteration 24 — US-025: Add accessibility to CareerConstellation
**Status:** Complete
**Changes:**
- Updated `src/components/CareerConstellation.tsx` with four accessibility features:
  - **Screen-reader description**: `buildScreenReaderDescription()` generates a hidden `<p>` (sr-only via clip rect) describing all 5 roles, their organizations, year ranges, and associated skills from `roleSkillMappings`
  - **Keyboard navigation**: Hidden `<button>` elements overlaid on the SVG container, one per role node. Tab navigates through roles, Enter/Space triggers `onRoleClick`. Each button has descriptive `aria-label` (role name, org, year range)
  - **Focus indicators**: SVG `.focus-ring` circle (ROLE_RADIUS + 4px) rendered behind each role node. Transparent by default, becomes teal `#0D6E6E` stroke when the corresponding hidden button receives focus (tracked via `focusedNodeId` state + `useEffect` on D3 selection)
  - **prefers-reduced-motion**: When enabled, simulation runs 300 ticks synchronously (`simulation.stop()` + loop), then renders final positions immediately — no animation frames. Uses the established module-scope `matchMedia` check pattern
- Imported `roleSkillMappings` from constellation data for SR description
- Added `useCallback` for `handleNodeKeyDown` to prevent re-renders
**Learnings:**
- D3 focus indicators work via a dual approach: hidden HTML buttons for actual keyboard focus, plus D3-drawn SVG circles that respond to React state changes — avoids fighting D3's imperative model with React's declarative focus management
- Running `simulation.tick()` in a loop (300 iterations) is sufficient to reach stable positions for this graph size (5 roles + 21 skills)
- The `.focus-ring` circle must be appended before the main circle in the SVG group to render behind it (SVG painting order = DOM order)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — not yet wired into CareerActivityTile (US-026).

### Iteration 25 — US-026: Add hover and click interactions to CareerConstellation
**Status:** Complete
**Changes:**
- Updated `src/components/CareerConstellation.tsx` with three interaction features:
  - **Hover highlighting**: Built adjacency map from `constellationLinks`. On `mouseenter`, non-connected nodes fade to 0.15 opacity. Connected links brighten to teal (`#0D6E6E`), thicken to 2px, increase opacity to 0.7. Non-connected links dim to 0.1 opacity. Role hover also scales connected skill nodes up (+3px radius) via D3 transition (150ms).
  - **Hover reset**: On `mouseleave`, all nodes reset to full opacity, skill circles return to `SKILL_RADIUS`, links return to default stroke/opacity/width.
  - **Click handlers**: Click on any node calls `callbacksRef.current.onRoleClick(id)` or `onSkillClick(id)` via the existing callbacksRef pattern (avoids stale closures).
  - Added `.node-circle` and `.node-label` classes to circles/text for targeted D3 selections during hover
- Updated `src/components/tiles/CareerActivityTile.tsx`:
  - Replaced placeholder `<div>` with actual `<CareerConstellation>` component
  - Added `handleRoleClick(roleId)` → finds consultation by ID → `openPanel({ type: 'career-role', consultation })`
  - Added `handleSkillClick(skillId)` → finds skill by ID → `openPanel({ type: 'skill', skill })`
  - Refactored `handleItemClick` to delegate to `handleRoleClick` for consistency
  - Imported `skills` from `@/data/skills` and `CareerConstellation` from `../CareerConstellation`
**Learnings:**
- D3 hover uses `mouseenter`/`mouseleave` (not `mouseover`/`mouseout`) to avoid bubbling issues with nested SVG groups
- The adjacency map uses source/target strings from `constellationLinks` (pre-simulation), not SimNode objects — link data gets resolved by D3 after forceLink runs, so during hover the source/target may be either string or SimNode objects. The click/hover handlers check both forms.
- The `callbacksRef` pattern established in US-023 works perfectly for D3 click events — no stale closures
- Pre-existing lint issues: `_sectionId` error + 2 context warnings — all unrelated
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — no browser tools available.

### Iteration 26 — US-027: Restyle LoginScreen with teal accents
**Status:** Complete
**Changes:**
- Updated `src/components/LoginScreen.tsx`:
  - Replaced all `#005EB8` (NHS Blue) with `#0D6E6E` (teal accent): shield icon color, active field borders, cursor color, button default bg, focus ring
  - Replaced `#004D9F` (hover) with `#0A8080` (teal hover)
  - Replaced `#004494` (pressed) with `#085858` (teal pressed)
  - Background color: `#1E293B` → `#1A2B2A` (warmer, cohesive with dashboard palette)
  - Shield icon container: `rgba(0, 94, 184, 0.07)` → `rgba(13, 110, 110, 0.08)` (teal-tinted)
**Learnings:**
- LoginScreen had 6 instances of `#005EB8` — all replaced for consistency
- The background change from `#1E293B` (slate) to `#1A2B2A` (dark teal-green) creates visual cohesion with the teal accent palette
- Button states follow the teal gradient: default #0D6E6E → hover #0A8080 → pressed #085858 (progressively darker)
**Quality checks:** typecheck ✓, lint ✓ (1 pre-existing error + 2 warnings), build ✓
**Visual review:** Skipped — no browser tools available.

---

## 2026-02-14 - US-028
- **What was implemented:** Changed login username from A.CHARLWOOD to a.recruiter, added connection status indicator with red→green transition, updated button disabled logic to require both typing complete AND connection established.
- **Files changed:**
  - `src/components/LoginScreen.tsx` — new `connectionState` state, connection timer (2000ms), connection status indicator UI (6px dot + Geist Mono text), `canLogin` derived state replacing `typingComplete` for button control
  - `src/components/DashboardLayout.tsx` — fixed pre-existing lint error (unused `_sectionId` parameter, added eslint-disable comment)
- **Learnings for future iterations:**
  - The DashboardLayout had a pre-existing lint error with `_sectionId` — ESLint config doesn't respect underscore-prefix unused var convention, needed `eslint-disable-next-line` comment. TypeScript `tsc -b` (used in build) DOES respect underscore prefix though.
  - Connection status uses CSS `transition: 300ms` for the color change — matches the spec for smooth dot/text color transition
  - `canLogin` is a derived value (not state) combining `typingComplete && connectionState === 'connected'` — cleaner than adding another state variable

---

## 2026-02-14 - US-029
- **What was implemented:** Added post-login loading state with CSS spinner (~600ms) that replaces the login card content after clicking Log In. Updated TopBar session display name from "Dr. A.CHARLWOOD" to "A.RECRUITER".
- **Files changed:**
  - `src/components/LoginScreen.tsx` — new `isLoading` state, handleLogin now sets isLoading before isExiting, card content conditionally renders either login form or spinner + "Loading clinical records..." text. Spinner uses CSS `login-spin` animation.
  - `src/components/TopBar.tsx` — changed session name from "Dr. A.CHARLWOOD" to "A.RECRUITER"
  - `src/index.css` — added `@keyframes login-spin` and `.login-spinner` class, plus `prefers-reduced-motion` override (static indicator, no spin)
- **Learnings for future iterations:**
  - The loading state replaces card content via conditional rendering (`isLoading ? spinner : form`) rather than an overlay — keeps the card dimensions stable
  - The sequence is: buttonPressed (100ms) → isLoading (600ms) → isExiting (200ms) → onComplete. With reduced motion, loading and exit delays are 0ms.
  - Spinner uses pure CSS animation (`border-top-color` trick) — no library needed

---

## 2026-02-14 - US-030
- **What was implemented:** Updated CommandPalette search index to include all 21 skills (not just 5), added `panel` action type to PaletteAction union, and wired skill/KPI/project palette results to open detail panels directly.
- **Files changed:**
  - `src/lib/search.ts` — Added `panel` action type with `DetailPanelContent` payload. Skills section now iterates all 21 skills from `skills.ts` (was hardcoded to 5). Project results find matching `Investigation` by ID and use `panel` action. Achievement results find matching `KPI` by ID and use `panel` action. Imported `kpis` and `DetailPanelContent` type.
  - `src/components/DashboardLayout.tsx` — Added `panel` case to `handlePaletteAction` switch that calls `openPanel(action.panelContent)`. Imported `useDetailPanel` from context.
- **Learnings for future iterations:**
  - The `panel` action type carries a full `DetailPanelContent` discriminated union payload — this means any palette item can open any detail panel type without intermediate mapping
  - Achievement "Team of 12 Led" was updated to "1.2M Population Served" to match the KPI data change from US-006
  - For projects, a fallback to `scroll` action is used when the investigation ID doesn't match — defensive pattern for data mismatches

---

## 2026-02-14 - US-031
- **What was implemented:** Responsive testing and fixes for all new components. Audited DetailPanel, SubNav, CareerConstellation, dashboard grid, CoreSkillsTile, touch targets, and 375px overflow.
- **Files changed:**
  - `src/components/SubNav.tsx` — Added `overflowX: auto`, `scrollbarWidth: 'none'`, horizontal padding, `flexShrink: 0` on tab buttons, `minHeight: 36px` for touch targets, flex layout for vertical centering
  - `src/index.css` — Added `.subnav-scroll::-webkit-scrollbar { display: none }` for WebKit scrollbar hiding
  - `src/components/DetailPanel.tsx` — Enlarged close button from 32x32px to 44x44px for mobile touch target compliance
  - `src/components/tiles/CoreSkillsTile.tsx` — Added `minHeight: 44px` to SkillRow and "View all" button for touch target compliance
  - `src/components/tiles/ProjectsTile.tsx` — Added `minHeight: 44px` to ProjectItem for touch target compliance
  - `src/components/tiles/LastConsultationTile.tsx` — Added `minHeight: 44px` to "View full record" button
- **Audit results (already passing):**
  - DetailPanel: `@media (max-width: 767px)` already set both widths to 100vw ✓
  - CareerConstellation: `getHeight()` already returns 400/300/250px by breakpoint ✓
  - Dashboard grid: mobile-first 1fr → 2fr at 768px, KPIs + Projects stack correctly ✓
  - CoreSkillsTile: `full` prop spans both columns at all breakpoints ✓
  - No horizontal overflow at 375px: TopBar search hidden <768px, no problematic nowrap on wide content ✓
- **Learnings for future iterations:**
  - `scrollbarWidth: 'none'` (Firefox) + `::-webkit-scrollbar { display: none }` (Chrome/Safari) together hide scrollbars cross-browser
  - WCAG touch target minimum is 44x44px — check all `role="button"`, `<button>`, and clickable elements
  - SubNav at 375px has ~345px available (375 - 2*16px padding) — 5 short labels with 24px gaps fit without scroll, but the scroll fallback is good insurance

## 2026-02-14 — US-032
- **What was implemented:** Reduced motion audit, final cleanup, and visual review
- **Files changed:**
  - `src/index.css` — Added prefers-reduced-motion overrides for SubNav button transitions and smooth scroll behavior. Removed 18 unused `--pmr-*` legacy CSS variables and `.pmr-theme` utility class.
  - `src/components/LoginScreen.tsx` — Connection status dot and text transitions now respect `prefersReducedMotion` (instant when enabled).
  - `src/components/detail/ProjectDetail.tsx` — Created missing ProjectDetail renderer (project name, year, status badge, methodology, tech stack tags, results bullets, external link button).
  - `src/components/DetailPanel.tsx` — Wired ProjectDetail for `content.type === 'project'`. Removed placeholder fallback (all content types now have renderers).
  - Deleted `src/hooks/useBreakpoint.ts` (unused)
  - Deleted `src/data/profile.ts` (unused — PatientSummaryTile has profile text hardcoded)
- **Learnings for future iterations:**
  - ProjectDetail was missing despite US-019 being marked as passed — always verify file existence, not just PRD status
  - `profile.ts` was created but never imported — PatientSummaryTile hardcodes the profile text instead
  - `useBreakpoint.ts` was orphaned after its consumers were deleted in US-001
  - Legacy `--pmr-*` CSS variables were all superseded by the new design token system and safe to remove
  - `pmr-scrollbar` class is still actively used (Sidebar, DashboardLayout, CommandPalette) — do not remove
  - SubNav inline transitions need CSS `!important` override in prefers-reduced-motion since they're set via inline styles
  - The `html { scroll-behavior: smooth }` also needs a reduced-motion override to `auto`
---

## 2026-02-14 - US-001 (Dashboard Restructure PRD)
- Changed initial Phase state in App.tsx from 'boot' to 'pmr' to skip boot/login for dev iteration
- Files changed: src/App.tsx
- Created Ralph/prd.json for new Dashboard Restructure PRD (17 stories)
- **Learnings for future iterations:**
  - Branch `ralph/dashboard-restructure` created fresh from master
  - All previous codebase patterns still apply
---

## 2026-02-14 - US-002
- Removed the fabricated 'duty-pharmacist-2016' entry (Duty Pharmacy Manager, Tesco, Aug 2016–Nov 2017) from consultations.ts, constellation nodes, constellation links, and roleSkillMappings
- Files changed: src/data/consultations.ts, src/data/constellation.ts
- **Learnings for future iterations:**
  - CareerActivityTile.tsx still has a `consultationId: 'duty-pharmacist-2016'` reference on the "Community Pharmacist" timeline entry — this is a dangling reference that US-003 will clean up by removing that timeline entry
  - The constellation data (nodes, links, roleSkillMappings) all reference each other by string ID — removing a role requires removing from all three arrays
  - After removal: 4 consultations, 4 role nodes, 4 role-skill mappings, 21 skill nodes remain
---

## 2026-02-14 - US-004
- Created `src/components/ParentSection.tsx` — wrapper component for top-level dashboard sections
- Uses existing `Card` component with `full` prop for full-width spanning
- Header: `<h2>` at 2.4rem, weight 700, `--text-primary` color, no colored dot
- 1.333rem (20px) padding below header before children render
- Props: `title`, `children`, optional `className` and `tileId` (passed through to Card)
- Files changed: src/components/ParentSection.tsx (new)
- **Learnings for future iterations:**
  - ParentSection is intentionally thin — it wraps Card and adds the large header, nothing more
  - The `tileId` prop passes through to Card for command palette scroll targeting
  - Subsection headers (CardHeader with colored dots) remain the existing pattern — ParentSection headers are visually distinct by size and weight alone
---

## 2026-02-14 - US-003
- Fixed inaccurate timeline entries in CareerActivityTile.tsx buildTimeline() to match CV_v4.md
- **Removed:** Power BI Data Analyst Associate cert, Clinical Pharmacy Diploma cert, SQL Analytics Transformation project, Budget Oversight project, Community Pharmacist role (dangling duty-pharmacist-2016 reference)
- **Added:** NHS Leadership Academy — Mary Seacole Programme cert (2018), A-Levels education entry (2009–2011)
- **Fixed role titles/dates:** Deputy Head (was "Senior Data Analyst"), High-Cost Drugs & Interface Pharmacist (was "Prescribing Data Pharmacist"), Pharmacy Manager at Tesco (was "Community Pharmacist at Boots UK"). All consultationIds now map to existing consultations.
- Files changed: src/components/tiles/CareerActivityTile.tsx
- **Learnings for future iterations:**
  - The previous timeline had inaccurate role titles that didn't match consultations.ts or CV_v4.md — always cross-reference both data source and CV
  - All 4 role entries now correctly reference their matching consultation IDs: interim-head-2025, deputy-head-2024, high-cost-drugs-2022, pharmacy-manager-2017
  - Timeline now has 8 entries: 4 roles + GPhC cert + Mary Seacole cert + MPharm edu + A-Levels edu
---

## 2026-02-14 - US-005
- Restructured PatientSummaryTile to use ParentSection wrapper with "Patient Summary" as large h2 header
- Merged LatestResultsTile content (MetricCard components, KPI grid) into PatientSummaryTile as a subsection with CardHeader "LATEST RESULTS"
- Removed the 4 headline metric figures (9+ Years, 1.2M, £220M, £14.6M+) strip from PatientSummaryTile
- Removed standalone LatestResultsTile import and rendering from DashboardLayout
- Files changed: src/components/tiles/PatientSummaryTile.tsx, src/components/DashboardLayout.tsx
- **Learnings for future iterations:**
  - The MetricCard component from LatestResultsTile was moved wholesale into PatientSummaryTile — it uses useDetailPanel for KPI click-to-detail, so the import chain followed
  - ParentSection wraps Card with full prop, so the tileId passes through ParentSection → Card → data-tile-id attribute for command palette scroll targeting
  - The LatestResultsTile.tsx file still exists but is no longer imported — US-010 will clean it up
---

## 2026-02-14 - US-006
- Replaced standalone CareerActivityTile with ParentSection titled "Patient Pathway" containing CareerConstellation graph
- Moved onRoleClick/onSkillClick handlers from CareerActivityTile into DashboardLayout (using consultations + skills data imports)
- Removed CareerActivityTile import from DashboardLayout
- CareerActivityTile.tsx still exists but is no longer imported — the timeline entries will be handled in US-007/US-008
- Files changed: src/components/DashboardLayout.tsx
- **Learnings for future iterations:**
  - The CareerActivityTile contained both the constellation graph AND the timeline activity grid — US-006 only moves the graph into the parent section
  - The onRoleClick/onSkillClick handlers were duplicated from CareerActivityTile into DashboardLayout since they need to be passed down to CareerConstellation. The same pattern (find consultation/skill by ID, openPanel) is used.
  - ParentSection with tileId="patient-pathway" provides scroll targeting for command palette — US-013 will update palette data to use this new tileId
---

## 2026-02-14 - US-007
- Moved Last Consultation content from standalone tile into Patient Pathway ParentSection as a subsection
- Created `LastConsultationSubsection` component within DashboardLayout.tsx — renders green dot CardHeader + date/org/type/band fields + role title + examination bullets + "View full record" button
- Deleted `src/components/tiles/LastConsultationTile.tsx` — content fully inlined
- Removed LastConsultationTile import from DashboardLayout
- Files changed: src/components/DashboardLayout.tsx (modified), src/components/tiles/LastConsultationTile.tsx (deleted)
- **Learnings for future iterations:**
  - The LastConsultationSubsection is defined as a standalone function component in DashboardLayout.tsx (not inside the export) — this keeps it clean and avoids nesting component definitions
  - `marginTop: 24px` on the subsection wrapper creates visual separation from the constellation graph above
  - The subsection uses `useDetailPanel` independently — it doesn't need to receive openPanel as a prop from DashboardLayout
  - All the same rendering logic from LastConsultationTile was preserved: formatDate, getEmploymentType, getBand, field labels, bullet dots, hover states, keyboard handlers, aria labels
  - Added `aria-hidden="true"` to bullet dots (decorative) which was missing in the original LastConsultationTile
---

## 2026-02-14 - US-008
- Added two-column work experience and skills layout inside Patient Pathway ParentSection, below Last Consultation subsection
- Created `src/components/WorkExperienceSubsection.tsx` — lists all 4 roles from consultations.ts with accordion expand (teal dot CardHeader "WORK EXPERIENCE"). Each role shows title, org, date range; expands to show examination bullets, coded entries, and "View full record" link
- Created `src/components/RepeatMedicationsSubsection.tsx` — categorised skills with expand (amber dot CardHeader "REPEAT MEDICATIONS"). Same content as CoreSkillsTile: 3 categories (Technical, Healthcare Domain, Strategic & Leadership), 4 skills per category with "View all" buttons, click to open detail panel
- Added `.pathway-columns` CSS class in index.css — 1 column default, 2 columns at 768px, 16px gap
- Removed standalone CoreSkillsTile from DashboardLayout grid
- Files changed: src/components/DashboardLayout.tsx, src/index.css, src/components/WorkExperienceSubsection.tsx (new), src/components/RepeatMedicationsSubsection.tsx (new)
- **Learnings for future iterations:**
  - WorkExperienceSubsection and RepeatMedicationsSubsection are standalone components (not defined inside DashboardLayout) to keep the file manageable — same pattern as LastConsultationSubsection but in separate files due to size
  - The two-column grid uses `.pathway-columns` (not `.activity-grid`) to avoid conflicting with the CareerActivityTile's existing responsive grid
  - CoreSkillsTile.tsx still exists but is no longer imported from DashboardLayout — US-010 will clean it up
  - The RepeatMedicationsSubsection is a near-copy of CoreSkillsTile internals minus the Card wrapper — both files exist until cleanup in US-010
---

## 2026-02-14 - US-009
- Moved Education content from standalone EducationTile into Patient Pathway ParentSection as the bottom-most subsection
- Created `src/components/EducationSubsection.tsx` — standalone component with purple dot CardHeader "EDUCATION", renders 3 entries (Mary Seacole, MPharm, A-Levels) with hover, click-to-detail panel, inline details
- Deleted `src/components/tiles/EducationTile.tsx` — content fully moved to EducationSubsection
- Updated DashboardLayout: replaced EducationTile import/render with EducationSubsection inside Patient Pathway
- Files changed: src/components/DashboardLayout.tsx (modified), src/components/EducationSubsection.tsx (new), src/components/tiles/EducationTile.tsx (deleted)
- **Learnings for future iterations:**
  - Git detected the move as a rename (91% similarity) — the EducationSubsection is nearly identical to EducationTile minus the Card wrapper
  - Same pattern as WorkExperienceSubsection and RepeatMedicationsSubsection: standalone file, `marginTop: 24px` for spacing from preceding section, uses CardHeader for subsection header
  - All Patient Pathway subsections now in place: CareerConstellation → LastConsultation → WorkExperience + RepeatMedications (two-column) → Education
---

## 2026-02-14 - US-010
- Deleted 3 orphaned tile files: CareerActivityTile.tsx, CoreSkillsTile.tsx, LatestResultsTile.tsx (LastConsultationTile and EducationTile were already deleted in US-007/US-009)
- Removed unused `.activity-grid` CSS class from index.css (was only used by deleted CareerActivityTile)
- Updated 2 stale comments referencing deleted tiles (index.css, SkillsAllDetail.tsx)
- Verified no broken imports remain — grep found zero import references to any deleted tile
- Verified dashboard grid: PatientSummaryTile (full width) + ProjectsTile (half width) + Patient Pathway ParentSection (full width)
- Browser verification: no visual gaps, all content renders correctly
- Files changed: src/components/tiles/CareerActivityTile.tsx (deleted), src/components/tiles/CoreSkillsTile.tsx (deleted), src/components/tiles/LatestResultsTile.tsx (deleted), src/index.css, src/components/detail/SkillsAllDetail.tsx
- **Learnings for future iterations:**
  - ProjectsTile remains as a standalone tile — it makes sense outside Patient Pathway since projects are cross-cutting, not career-timeline-specific
  - The `.activity-grid` CSS was orphaned when CareerActivityTile was removed — always check for CSS classes that were only used by deleted components
  - Only 2 tile files remain in src/components/tiles/: PatientSummaryTile.tsx and ProjectsTile.tsx
---

## 2026-02-14 - US-011
- Improved constellation graph visual clarity with larger nodes, thicker links, and better contrast
- Role node radius: 24→30, skill node radius: 10→14, collide radius: 30→36
- Role label font: 8→10px, skill label font: 9→11px, skill label color darkened (#5B7A78→#4A6B69)
- Link stroke: 1→1.5px, opacity: 0.3→0.45, color: #D4E0DE→#B0C4C0 (darker, more visible)
- Background gradient: center #F0F5F4→#EDF2F1 (slightly darker), edge #FFFFFF→#F7FAF9 (warmer)
- Force simulation: charge -200→-120, link distance 80→65, link strength 0.5→0.6, Y strength 0.3→0.4, skill X pull 0.05→0.08, padding 80→60
- Hover highlight link width: 2→2.5px, skill scale-up: +3→+4px
- All existing interactions preserved (hover dim/highlight, click, keyboard nav)
- Responsive height tiers unchanged (400/300/250px)
- Files changed: src/components/CareerConstellation.tsx
- **Learnings for future iterations:**
  - Reducing charge repulsion (-200→-120) combined with shorter link distance (80→65) makes nodes cluster more tightly, filling the container better
  - The `#B0C4C0` link color at 0.45 opacity provides much better visibility than `#D4E0DE` at 0.3 while still being subtle
  - Hover reset values must exactly match the initial link styling — always update both together
  - Skill label offset (dy) should increase proportionally with radius: 14+14=28 (was 10+12=22)
---

## 2026-02-14 - US-012
- Added cross-component hover-highlighting between work experience/skills entries and the constellation graph
- DashboardLayout: added `highlightedNodeId` state + `handleNodeHighlight` callback, wired to CareerConstellation, WorkExperienceSubsection, and RepeatMedicationsSubsection
- CareerConstellation: new `highlightedNodeId` prop + `connectedMapRef` to store adjacency map + useEffect that applies same dim/highlight logic as internal hover when external ID changes
- WorkExperienceSubsection: added `onNodeHighlight` prop, triggers on mouseenter/mouseleave of each RoleItem container (passes consultation.id)
- RepeatMedicationsSubsection: added `onNodeHighlight` prop chain through CategorySection → SkillRow, integrated with existing hover handlers (passes skill.id)
- Browser verified: hovering "Interim Head" work entry highlights corresponding role node + connected skills in graph; hovering "Python" skill entry highlights Python node + connected role nodes
- Files changed: src/components/CareerConstellation.tsx, src/components/DashboardLayout.tsx, src/components/WorkExperienceSubsection.tsx, src/components/RepeatMedicationsSubsection.tsx
- **Learnings for future iterations:**
  - The `connectedMapRef` pattern stores the D3 adjacency map in a React ref so a separate useEffect (responding to prop changes) can read it without depending on the main D3 initialization useEffect
  - External highlight useEffect must reset styles when highlightedNodeId becomes null — use the same baseline values as the hover mouseleave handler
  - The onNodeHighlight callbacks integrate cleanly with existing mouseenter/mouseleave handlers in SkillRow (just append the highlight call)
---

## 2026-02-14 - US-013
- Updated command palette data to reflect restructured dashboard with accurate entries
- **Experience**: Replaced 4 hardcoded inaccurate role entries with dynamic iteration over all consultations from consultations.ts. Changed action from `expand` (targeting deleted career-activity tile) to `panel` (opening career-role detail panel directly)
- **Projects**: Replaced 3 hardcoded fake entries (£220M Budget, SQL Analytics Transformation, Team Data Literacy) with dynamic iteration over all 5 investigations from investigations.ts. Subtitle uses first sentence of methodology + year
- **Education**: Removed Power BI Data Analyst Associate cert and Clinical Pharmacy Diploma (not in CV). Added Mary Seacole Programme and A-Levels. Updated tileId from `education` to `patient-pathway`
- **Achievements**: Updated fallback tileId from `latest-results` to `patient-summary` (LatestResults is now a subsection within PatientSummary)
- **Legacy exports**: Removed `SearchResult` interface, `buildLegacySearchIndex()`, and `groupResultsBySection()` — confirmed no imports exist anywhere in the codebase. Also removed unused imports (medications, problems, documents, ViewId, FuseResult)
- Files changed: src/lib/search.ts, Ralph/prd.json, Ralph/progress.txt
- **Learnings for future iterations:**
  - Investigation type uses `requestedYear` not `year` — always check the type interface before referencing properties
  - Dynamically iterating over data arrays (consultations, investigations, skills) is more maintainable than hardcoded entries — data changes propagate automatically
  - The `expand` palette action type is still in the union but no longer used by any items — keeping the handler in DashboardLayout is harmless
---

## Iteration 14 — US-014: Responsive verification and fixes (2026-02-14)

### Status: PASSED ✅

### Changes
- **Card.tsx**: Added `minWidth: 0` and `overflow: 'hidden'` to base styles — fixes CSS Grid items defaulting to `min-width: auto` which prevented shrinking below intrinsic content width, causing 912px-wide articles at 375px viewport
- **ParentSection.tsx**: Replaced fixed `fontSize: '2.4rem'` with responsive Tailwind classes: `text-[1.5rem] sm:text-[1.8rem] md:text-[2rem] lg:text-[2.4rem]` — scales parent section headers appropriately across breakpoints
- **PatientSummaryTile.tsx**: Made KPI grid responsive — replaced hardcoded `gridTemplateColumns: '1fr 1fr'` with `grid-cols-1 xs:grid-cols-2` so KPIs stack single-column below 480px
- **SubNav.tsx**: Fixed two issues:
  1. Changed `justifyContent: 'center'` to left-aligned by default with `md:justify-center` — prevents first nav item being pushed off-screen at mobile widths
  2. Updated stale tileIds (`core-skills`, `career-activity`, `education`) to match restructured dashboard anchors (`section-skills`, `section-experience`, `section-education`)
- **DashboardLayout.tsx**: Added `data-tile-id` wrapper divs around WorkExperienceSubsection, RepeatMedicationsSubsection, and EducationSubsection so SubNav can scroll to these sections within Patient Pathway

### Verification (Playwright at 4 breakpoints)
- **375px (mobile)**: Single column, all articles 343px, no overflow, constellation SVG 301×250, pathway columns stacked, KPI grid single-column, SubNav starts from left edge
- **768px (tablet)**: Two-column grid (352px each), full-width tiles 720px, pathway columns side-by-side (331px), KPI 2-column, sidebar hidden, no overflow
- **1024px (desktop)**: Sidebar visible at 272px, two-column grid (340px each), full-width tiles 696px, pathway columns 2-column (319px), constellation SVG 678px
- **1920px (wide)**: Two-column grid (788px each), full-width tiles 1592px, pathway columns 767px each, constellation SVG 1550px, well-balanced layout
- **No horizontal scrollbar at any breakpoint** (`scrollWidth === clientWidth` confirmed at all 4 widths)

### Learnings
- CSS Grid items default to `min-width: auto` — always add `minWidth: 0` + `overflow: hidden` to grid item components to prevent content blowout
- SubNav tileIds must be updated whenever dashboard sections are restructured — stale IDs cause scroll-to-section to silently fail
- The `justifyContent: 'center'` on a scrollable flex container pushes the first items off-screen at narrow viewports — use media-query-based centering instead
---

## Iteration 15 — US-015: Explore parent header typography options
**Status**: PASS
**Commit**: (this iteration)

### What was done
Visual exploration of parent section header typography. Tested 14 combinations in Playwright by dynamically applying styles to the h2 elements and taking screenshots.

### Options tested

| # | Font | Weight | Size | Case | Tracking | Verdict |
|---|------|--------|------|------|----------|---------|
| 00 | Elvaro | 700 | 2.4rem | Title | normal | Baseline — solid but generic bold |
| 01 | Elvaro | 500 | 2.4rem | Title | normal | Nearly identical to 700 |
| 02 | Elvaro | 300 | 2.4rem | Title | normal | Lighter, more elegant |
| 03 | Elvaro | 600 | 2.2rem | Title | -0.02em | **SELECTED** — compact, refined, premium |
| 04 | Elvaro | 400 | 2.6rem | Title | -0.03em | Light + large, premium but lacks authority |
| 05 | Elvaro | 900 | 2.4rem | Title | normal | ~Same as 700 (font caps out) |
| 06 | Elvaro | 600 | 1.4rem | Upper | 0.08em | Too similar to sub-headers |
| 07 | Elvaro | 500 | 1.8rem | Upper | 0.05em | Strong clinical feel, runner-up |
| 08 | Blumir | 500 | 2.4rem | Title | -0.01em | Distinct geometric character |
| 09 | Blumir | 300 | 2.8rem | Title | -0.02em | Elegant but lacks authority |
| 10 | Blumir | 700 | 2.4rem | Title | -0.02em | Bold, assertive geometric |
| 11 | Blumir | 100 | 3rem | Title | -0.01em | Too thin/delicate |
| 12 | Blumir | 500 | 1.6rem | Upper | 0.06em | Blurs with sub-headers |
| 13 | Elvaro | 600 | 2.4rem | Title | -0.02em | Teal color — competes with KPI accents |
| 14 | Blumir | 400 | 2.6rem | Title | -0.03em | Clean, refined, distinct from body |

### Selection: Option 3 — Elvaro Grotesque 600, 2.2rem, title case, -0.02em

**Rationale:**
- Font consistency (Elvaro throughout) — one typeface used well > two fonts competing
- 600 weight with -0.02em tracking feels deliberately chosen, not default
- Slightly smaller than baseline (2.2rem vs 2.4rem) is more data-dense/clinical
- Title case preserves warmth and readability vs uppercase
- Clear hierarchy: parent headers (2.2rem/600) > sub-headers (12px/600 uppercase) > body (13px/400)
- Tight tracking gives premium, considered quality

**Runner-up:** Option 7 (Elvaro 500, 1.8rem, uppercase, 0.05em) — strongest clinical identity but more austere

### Key observations
- Elvaro weights 500/700/900 render nearly identically — the font has limited visual weight range
- Blumir's geometric character creates nice font contrast but mixing two typefaces adds complexity without clear benefit
- Uppercase headers need careful sizing to not blur with the 12px uppercase sub-headers (LATEST RESULTS, etc.)
- Teal-colored headers compete with KPI accent values — parent headers should stay in text-primary
- Tight negative tracking (-0.02em to -0.03em) consistently improves the premium feel at heading sizes
---

## Iteration 16 — US-016: Apply chosen parent header typography
**Status**: PASS
**Commit**: (this iteration)

### What was done
Applied the selected typography from US-015 to ParentSection.tsx:
- **Font**: Elvaro Grotesque (unchanged — consistent with body)
- **Weight**: 600 (down from 700)
- **Letter-spacing**: -0.02em (tight tracking)
- **Responsive scale**: `1.375rem` → `1.6rem` (sm) → `1.8rem` (md) → `2.2rem` (lg)
  - Previous: `1.5rem` → `1.8rem` → `2rem` → `2.4rem`

### Changes
- **ParentSection.tsx**: Updated h2 className responsive sizes and inline style (fontWeight 700→600, added letterSpacing -0.02em)

### Verification
- **Desktop (1024px+)**: 35.2px / 600 weight / -0.704px tracking — refined, premium feel
- **Mobile (375px)**: 22px / 600 weight — proportional, readable
- Both "Patient Summary" and "Patient Pathway" headers identical
- Clear hierarchy: parent headers (2.2rem/600) > sub-headers (12px/600 uppercase) > body (13px/400)
---
